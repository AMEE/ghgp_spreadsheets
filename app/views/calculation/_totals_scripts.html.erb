<% content_for :js do %>

  <%= javascript_tag do %>

    $(document).ready(function(){

      setContainerDimensions();

      tableCells$ = $('td.totals_table_cell');

      tableCells$.each(function() {
        $(this).css('width', 100);
      });

      renderLoadingGif(tableCells$);

      jQuery.ajax({
        dataType: 'script',
        type:     'GET',
        url:      '/summary/update'
      });

    });

    function setContainerDimensions() {
      var tableWidth = $('#totals_table').width();
      var tableTabHeight = $('#table_tab_wrapper').height();
      var chartHeight = $('#chart_container').height();
      var verticalPadding = 50;

      $('#table_tab_wrapper').width(tableWidth);

      if (tableWidth < 640) {
        var horizontalPadding = 320;
        $('#table_chart_wrapper').width(tableWidth+horizontalPadding);
        $('#totals_page').width(tableWidth+horizontalPadding);
        if (tableTabHeight > chartHeight) {
          $('#totals_page').height(tableTabHeight+verticalPadding);
        } else {
          $('#totals_page').height(chartHeight+verticalPadding);
        }
      } else {
        var chartWidth = $('#chart_container').width();
        if (chartHeight < 300) {
          chartHeight = 70;
        }
        $('#table_chart_wrapper').width(tableWidth);
        $('#totals_page').width(tableWidth);
        $('#totals_page').height(tableTabHeight+chartHeight+verticalPadding);
        $('#chart_container').css('float', 'none').css('margin-left', ((tableWidth-chartWidth)/2));
      }
    }

  <% end %>
<% end %>
