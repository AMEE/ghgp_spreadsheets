<% form_id = "drill-form-#{rand(1e8)}" %>
<% form_tag({:action=>nil},{:id=>form_id}) do%>
  <%= hidden_field_tag 'form_id', form_id %>
  <table>
    <%@calculation.chosen_drills.each_value do |input|%>
      <tr>
        <td><%=label :entry,input.label,input.name%></td>
        <td><%= select_tag "_#{input.label}",
            options_for_select([input.value]),
            :disabled => true %>
          <%= hidden_field_tag "entry[#{input.label}]", input.value %></td>
      </tr>
    <%end%>
    <%input=@calculation.next_drill%>
    <% if input %>
      <tr>
        <td><%=label :entry,input.label,input.name%></td>
        <td>
          <%= select_tag "entry[#{input.label}]",
            options_for_select(
            ([nil]+input.choices).map{|x|[x,x.nil? ? :unset : x]}
          ) %>
        </td>
      </tr>
    <%end%>
    <%@calculation.future_drills.each do |input|%>
      <tr>
        <td><%=label :entry,input.label,input.name%></td>
        <td><%= select_tag "_#{input.label}",
            options_for_select([input.value]),
            :disabled => true %></td>
      </tr>
    <%end%>
    <%@calculation.profiles.each_value do |input|%>
      <tr><td><%=label :entry,input.label,input.name%></td><td><%= text_field :entry, input.label, "size" => 20, :value => input.value_if_given %></td></tr>
    <%end%>
    <%@calculation.chosen_outputs.each_value do |result|%>
      <tr><td><%=label :entry,result.label,result.name%></td><td><%= result.value_if_given %></td></tr>
    <%end%>
  </table>
<%end%>
<%= observe_form form_id, :url => {:action => 'result'}%>
<% javascript_tag do %>
  $('#<%=form_id%>').submit(function() {
  return false;
  });
<%end%>